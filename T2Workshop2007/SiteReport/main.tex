% vim: set tw=0:
\documentclass{beamer}
\usepackage{graphicx}

% Reasonable themes:
% Antibes Bergen Berkeley Berlin Frankfurt Goettingen Ilmenau Luebeck Malmoe
% Montpellier PaloAlto Rochester Singapore Szeged Warsaw bars boxes
% compatibility default lined plain shadow sidebar split tree
% And these ones include the author's name on every slide:
% Berkeley

% Declare themes.
\mode<presentation>
\usetheme{UWHEP}

% Personal macros.
\newcommand{\email}[1]{{\texttt #1}}
\newcommand{\newframe}[1]{\section{#1}
    \frametitle{\sc{#1}}}
\newcommand{\subframe}[1]{\subsection{#1}
    \frametitle{\sc{#1}}}
\newcommand{\supers}[1]{\ensuremath{^\textrm{#1}}}
\newcommand{\subs}[1]{\ensuremath{_\textrm{#1}}}

% Author information.
\title{Site Report}
\author[Will Maier]{Will Maier \\ \texttt{wcmaier@hep.wisc.edu}}
\institute[Wisconsin]{University of Wisconsin - High Energy Physics}
\date[8 March, 2007]{USCMS T2 Workshop, 8 March, 2007}
\logo{\includegraphics*[height=0.6cm]{../../Graphics/USCMS_logo.png}\hspace{.1cm}\includegraphics*[height=0.75cm]{../../Graphics/UW_logo.png}}

\begin{document}

% Choices in site architecture -- why did you make them, and what might you 
% want to change?  In particular, how has disk architecture impacted data 
% serving, data transfers, and reliability?  How are you handling day-to-day 
% management (including user support), and has that been sufficient during 
% exercises such as CSA06?

\begin{frame}
    \titlepage
\end{frame}

\section{Overview}
\subsection{Table of Contents}
\begin{frame}
    \tableofcontents
\end{frame}

\section{Site Architecture}
\subsection{Submit Machines}
\subsection{OE/SE}
% Tucker/Landry

\section{Storage Architecture}
\subsection{Transition to 500G SATA}
\begin{frame}
\frametitle{Disks}
\begin{itemize}
    \item SATA has significantly improved cabling and reduced hardware support
    \item Haven't experienced an unreasonably high failure rate with 500G disks
    \item Plan to outfit more compute nodes with large disk (500G, 750G?)
\end{itemize}
\end{frame}

\subsection{Newly Redundant AFS service}
\begin{frame}
\frametitle{AFS Load Balancing}
\begin{itemize}
    \item OSG volumes pose some annoying problems in AFS-land:
    \begin{itemize}
        \item Large units
        \item Read/write activity
    \end{itemize}
    \item We can't use AFS' native replication to provide redundant copies of  
    much of this data
    \item We cooked up a hack using AFS' {\tt @sysname}:
    \begin{itemize}
        \item A copy of the main OSG volume is stored on a separate server
        \item The backup is regularly synced (using {\tt rsync}) with the main copy
        \item The volumes are then made available through a nest of magic symlinks
        \item We can segregate access to the volumes by setting the {\tt sysname} on cluster hosts
        \begin{itemize}
            \item By architecture
            \item By task (interactive submit machine, compute node, head node)
            \item By priority
        \end{itemize}
    \end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Link Hierarchy}
\begin{verbatim}
    $ ls -ld /afs/hep.wisc.edu/osg/app*
    app_rw/
    app_ro/
    app -> app_links/@sys

    $ ls -l /afs/hep.wisc.edu/osg/app_links
    amd64_linux24 -> ../app_rw
    amd64_linux26 -> ../app_rw
    i386_linux24 -> ../app_rw
    i386_linux26 -> ../app_rw
    amd64_linux24_users -> ../app_ro
    amd64_linux26_users -> ../app_ro
    i386_linux24_users -> ../app_ro
    linux26_users -> ../app_ro
\end{verbatim}
\end{frame}

\subsection[dCache Load Balancing]{Effective Balancing of Files in dCache}
\begin{frame}[fragile]
\frametitle{dCache met a node...}
\begin{itemize}
    \item For a long, long time, dCache had fallen in love with a handful of nodes
    \begin{itemize}
        \item Nodes low on the list of pools sorted alphanumerically
        \item Produced a very pretty curve on the usageInfo page
    \end{itemize}
    \item dCache redirected its affections when we added new nodes lower on the list
    \item It's not clear why this was the case
    \item With 1.7.0, we were able to use {\tt costfactors} to cool dCache's 
    heels
    \item In {\tt PoolManager.conf}:
\end{itemize}
\begin{verbatim}
    set pool decision -spacecostfactor=0 -cpucostfactor=0
\end{verbatim}
\end{frame}

\begin{frame}
\frametitle{Results}
\begin{itemize}
    \item The Good:
    \begin{itemize}
        \item Very flat distribution of files
        \item Correctly shuffled files around after the affair
    \end{itemize}
    \item The (Potentially) Bad:
    \begin{itemize}
        \item If disks begin to fill up, the ReplicaManager will happily send more data down the pipe
        \item Most pools in {\tt ResilientPools} are also compute nodes, but the ReplicaManager doesn't care if the CPU's busy
    \end{itemize}
    \item We add more disk regularly, so we don't expect to run into the first condition
    \item CPU overload hasn't appeared to be problematic yet
\end{itemize}
\end{frame}

% \subsection{Added more dCache GridFTP doors}

\section{Management and Support}
\subsection{Overview}
\begin{frame}
\begin{itemize}
    \item Internal and public documentation in a wiki
    \begin{itemize}
        \item Running MoinMoin ({\tt http://moinmoin.wikiwikiweb.de/})
        \item Documenting all local CMS operations and production
    \end{itemize}
    \item User support provided with a problem tracker
    \begin{itemize}
        \item Running Roundup ({\tt http://roundup.sf.net/})
        \item Coordinating support of all Wisconsin activities:
        \begin{itemize}
            \item Analysis
            \item Production
            \item Hardware
            \item Systems and network
        \end{itemize}
    \end{itemize}
\end{itemize}
\end{frame}

\subsection{Wiki}
\begin{frame}
\frametitle{Wiki}
\begin{figure}
    \includegraphics*{Graphics/wiki.png}
    \caption{{\tt http://wiki.hep.wisc.edu/cmsops/}}
\end{figure}
\end{frame}

\subsection{Problem Tracker}
\begin{frame}
\frametitle{Problem Tracker}
\begin{figure}
    \includegraphics*{Graphics/problem-tracker.png}
    \caption{{\tt http://help.hep.wisc.edu/}}
\end{figure}
\end{frame}

\end{document}
